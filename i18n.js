// js/core/i18n.js
const translations = {
  en: {
    title: "AI Design Generator",
    createImages: "Create stunning images with AI",
    signIn: "Sign In",
    email: "Email Address",
    password: "Password",
    forgotPassword: "Forgot password?",
    noAccountText: "Don't have an account?",
    signUp: "Sign up",
    haveAccount: "Already have an account? Sign in",
    register: "Create Account",
    industryCode: "Industry Code",
    sendCode: "Send Verification Code",
    verifyCode: "Verify Code",
    back: "Back",
    fullName: "Full Name",
    confirmPassword: "Confirm Password",
    setup: "Setup",
    account: "Account",
    templates: "Templates",
    pastRecords: "Past Generation Records",
    createAccount: "Create Account",
    logout: "Logout",
    setupProfile: "Setup Your Profile",
    saveProfile: "Save Profile",
    yourAccount: "Your Account",
    editProfile: "Edit Profile",
    updateProfile: "Update Profile",
    cancel: "Cancel",
    generateImages: "Generate Images",
    selectTemplate: "Please select at least one template.",
    selectSpecs: "Select Specifications",
    selectModel: "Select AI Model",
    pollinations: "Pollinations AI",
    stability: "Stability AI (SDXL)",
    huggingface: "Hugging Face (FLUX.1-dev)",
    warningProduct: "Warning: Product name not set. Update now",
    copy: "Copy",
    reset: "Reset",
    addSpecification: "Add Specification",
    addValue: "Add Value",
    name: "Name",
    productName: "Product Name",
    emailLabel: "Email",
    industry: "Industry",
    template: "Template",
    master: "Master",
    notSpecified: "Not specified",
    none: "None",
    codeLabel: "(Code: {code})",
    generateIndustryCode: "Generate Industry Code",
    language: "Language",
    product: "Product",
    generating: "Generating images with {model}...",
    imagesGenerated: "Images generated successfully!",
    leftBetter: "Left is better",
    rightBetter: "Right is better",
    downloadAll: "Download all",
    bothBad: "Both bad",
    maxBadSelections: "Maximum bad selections reached.",
    pleaseSignIn: "Please sign in.",
    productNameRequired: "Product name required.",
    maxGeneration: "Maximum generation limit reached.",
    generationFailed: "Failed to generate images.",
    generationError: "Error during generation.",
    profileSaved: "Profile saved!",
    savingProfile: "Saving profile...",
    errorLoadingTemplates: "Error loading templates",
    uploadReference: "Upload Reference Image",
    errorUploadingImage: "Error uploading image",
    basedOnReference: "based on the uploaded reference image",
    errorGeneratingImages: "Error generating images",
    generatedLeftImage: "Generated Left Image",
    generatedRightImage: "Generated Right Image",
    errorSavingImages: "Error saving images",
    setProductName: "Please set your product name in Account Settings.",
    newTemplate: "Add new template",
    addTemplate: "Add",
    remove: "Remove",
    clientManagement: "Client Management",
    searchClient: "Search by client name or email...",
    search: "Search",
    allIndustries: "All Industries",
    allTemplates: "All Templates",
    allStatus: "All Status",
    noClientsFound: "No clients found matching your criteria.",
    previous: "Previous",
    next: "Next",
    pageInfo: "Page {current} of {total}",
    clientDetails: "Client Details",
    clientInfo: "Client Information",
    status: "Status",
    created: "Created",
    lastActive: "Last Active",
    templateSettings: "Template & Settings",
    assignedTemplate: "Assigned Template",
    noTemplate: "No Template",
    updateTemplate: "Update Template",
    creditManagement: "Credit Management",
    currentBalance: "Current Balance",
    creditAmount: "Amount",
    addCredits: "Add Credits",
    deductCredits: "Deduct Credits",
    resetCredits: "Reset to Default",
    generationHistory: "Generation History",
    totalGenerations: "Total Generations",
    thisMonth: "This Month",
    creditsUsed: "Credits Used",
    date: "Date",
    prompt: "Prompt",
    credits: "Credits",
    accountActions: "Account Actions",
    resetPassword: "Reset Password",
    lockAccount: "Lock Account",
    deleteAccount: "Delete Account"
  },
  zh: {
    title: "AI 设计生成器",
    createImages: "用 AI 秒速生成精美图像",
    signIn: "登录",
    email: "邮箱地址",
    password: "密码",
    forgotPassword: "忘记密码？",
    noAccountText: "没有账户？",
    signUp: "注册",
    haveAccount: "已有账户？登录",
    register: "创建账户",
    industryCode: "行业代码",
    sendCode: "发送验证码",
    verifyCode: "验证",
    back: "返回",
    fullName: "姓名",
    confirmPassword: "确认密码",
    setup: "设置",
    account: "账户",
    templates: "模板",
    pastRecords: "历史记录",
    createAccount: "创建账户",
    logout: "退出",
    setupProfile: "设置个人资料",
    saveProfile: "保存",
    yourAccount: "你的账户",
    editProfile: "编辑资料",
    updateProfile: "更新资料",
    cancel: "取消",
    generateImages: "生成图像",
    selectTemplate: "请选择至少一个模板。",
    selectSpecs: "选择规格",
    selectModel: "选择 AI 模型",
    pollinations: "Pollinations AI",
    stability: "Stability AI (SDXL)",
    huggingface: "Hugging Face (FLUX.1-dev)",
    warningProduct: "警告：未设置产品名称。立即更新",
    copy: "复制",
    reset: "重置",
    addSpecification: "添加规格",
    addValue: "添加值",
    name: "名称",
    productName: "产品名称",
    emailLabel: "邮箱",
    industry: "行业",
    template: "模板",
    master: "管理员",
    notSpecified: "未指定",
    none: "无",
    codeLabel: "（代码：{code}）",
    generateIndustryCode: "生成行业代码",
    language: "语言",
    product: "产品",
    generating: "正在使用 {model} 生成图像...",
    imagesGenerated: "图像生成成功！",
    leftBetter: "左图更好",
    rightBetter: "右图更好",
    downloadAll: "下载全部",
    bothBad: "两个都不好",
    maxBadSelections: "已达到最大重新生成次数。",
    pleaseSignIn: "请先登录。",
    productNameRequired: "需要产品名称。",
    maxGeneration: "已达到最大生成次数。",
    generationFailed: "生成图像失败。",
    generationError: "生成过程中发生错误。",
    profileSaved: "个人资料已保存！",
    savingProfile: "正在保存个人资料...",
    errorLoadingTemplates: "加载模板时出错",
    uploadReference: "上传参考图像",
    errorUploadingImage: "上传图像出错",
    basedOnReference: "基于上传的参考图像",
    errorGeneratingImages: "生成图像时出错",
    generatedLeftImage: "生成的左图",
    generatedRightImage: "生成的右图",
    errorSavingImages: "保存图像时出错",
    setProductName: "请在账户设置中设置产品名称。",
    newTemplate: "添加新模板",
    addTemplate: "添加",
    remove: "移除",
    clientManagement: "客户管理",
    searchClient: "按客户姓名或邮箱搜索...",
    search: "搜索",
    allIndustries: "所有行业",
    allTemplates: "所有模板",
    allStatus: "所有状态",
    noClientsFound: "未找到符合条件的客户。",
    previous: "上一页",
    next: "下一页",
    pageInfo: "第 {current} 页，共 {total} 页",
    clientDetails: "客户详情",
    clientInfo: "客户信息",
    status: "状态",
    created: "创建时间",
    lastActive: "最后活跃",
    templateSettings: "模板与设置",
    assignedTemplate: "分配的模板",
    noTemplate: "无模板",
    updateTemplate: "更新模板",
    creditManagement: "信用管理",
    currentBalance: "当前余额",
    creditAmount: "金额",
    addCredits: "添加信用",
    deductCredits: "扣除信用",
    resetCredits: "重置为默认",
    generationHistory: "生成历史",
    totalGenerations: "总生成次数",
    thisMonth: "本月",
    creditsUsed: "已使用信用",
    date: "日期",
    prompt: "提示",
    credits: "信用",
    accountActions: "账户操作",
    resetPassword: "重置密码",
    lockAccount: "锁定账户",
    deleteAccount: "删除账户"
  },
  yue: {
    title: "AI 設計生成器",
    createImages: "用 AI 即時生成靚圖",
    signIn: "登入",
    email: "電郵地址",
    password: "密碼",
    forgotPassword: "忘記密碼？",
    noAccountText: "未有帳戶？",
    signUp: "註冊",
    haveAccount: "已有帳戶？登入",
    register: "建立帳戶",
    industryCode: "行業代碼",
    sendCode: "發送驗證碼",
    verifyCode: "驗證",
    back: "返回",
    fullName: "全名",
    confirmPassword: "確認密碼",
    setup: "設定",
    account: "帳戶",
    templates: "模板",
    pastRecords: "歷史記錄",
    createAccount: "建立帳戶",
    logout: "登出",
    setupProfile: "設定個人檔案",
    saveProfile: "儲存",
    yourAccount: "你的帳戶",
    editProfile: "編輯檔案",
    updateProfile: "更新檔案",
    cancel: "取消",
    generateImages: "生成圖像",
    selectTemplate: "請選擇至少一個模板。",
    selectSpecs: "選擇規格",
    selectModel: "選擇 AI 模型",
    pollinations: "Pollinations AI",
    stability: "Stability AI (SDXL)",
    huggingface: "Hugging Face (FLUX.1-dev)",
    warningProduct: "警告：未設定產品名稱。立即更新",
    copy: "複製",
    reset: "重設",
    addSpecification: "新增規格",
    addValue: "新增值",
    name: "名稱",
    productName: "產品名稱",
    emailLabel: "電郵",
    industry: "行業",
    template: "模板",
    master: "管理員",
    notSpecified: "未指定",
    none: "無",
    codeLabel: "（代碼：{code}）",
    generateIndustryCode: "生成行業代碼",
    language: "語言",
    product: "產品",
    generating: "用 {model} 生成圖像...",
    imagesGenerated: "圖像生成成功！",
    leftBetter: "左圖較好",
    rightBetter: "右圖較好",
    downloadAll: "下載全部",
    bothBad: "兩個都唔啱",
    maxBadSelections: "已達最大重新生成次數。",
    pleaseSignIn: "請先登入。",
    productNameRequired: "需要產品名稱。",
    maxGeneration: "已達最大生成次數。",
    generationFailed: "生成圖像失敗。",
    generationError: "生成過程中發生錯誤。",
    profileSaved: "個人檔案已儲存！",
    savingProfile: "儲存緊個人檔案...",
    errorLoadingTemplates: "載入模板時出錯",
    uploadReference: "上載參考圖像",
    errorUploadingImage: "上載圖像出錯",
    basedOnReference: "基於上載嘅參考圖像",
    errorGeneratingImages: "生成圖像時出錯",
    generatedLeftImage: "生成嘅左圖",
    generatedRightImage: "生成嘅右圖",
    errorSavingImages: "儲存圖像時出錯",
    setProductName: "請喺帳戶設定中設定產品名稱。",
    newTemplate: "新增模板",
    addTemplate: "新增",
    remove: "移除",
    clientManagement: "客戶管理",
    searchClient: "按客戶姓名或電郵搜索...",
    search: "搜索",
    allIndustries: "所有行業",
    allTemplates: "所有模板",
    allStatus: "所有狀態",
    noClientsFound: "未搵到符合條件嘅客戶。",
    previous: "上一頁",
    next: "下一頁",
    pageInfo: "第 {current} 頁，共 {total} 頁",
    clientDetails: "客戶詳情",
    clientInfo: "客戶資訊",
    status: "狀態",
    created: "創建時間",
    lastActive: "最後活躍",
    templateSettings: "模板同設定",
    assignedTemplate: "分配嘅模板",
    noTemplate: "無模板",
    updateTemplate: "更新模板",
    creditManagement: "信用管理",
    currentBalance: "當前餘額",
    creditAmount: "金額",
    addCredits: "添加信用",
    deductCredits: "扣除信用",
    resetCredits: "重設為默認",
    generationHistory: "生成歷史",
    totalGenerations: "總生成次數",
    thisMonth: "今個月",
    creditsUsed: "已使用信用",
    date: "日期",
    prompt: "提示",
    credits: "信用",
    accountActions: "帳戶操作",
    resetPassword: "重設密碼",
    lockAccount: "鎖定帳戶",
    deleteAccount: "刪除帳戶"
  }
};

let currentLang = 'en';

/**
 * 翻译键，支持占位符 {key}
 */
function t(key, placeholders = {}) {
  let text = translations[currentLang]?.[key] ?? translations.en[key] ?? key;
  if (placeholders && typeof placeholders === 'object') {
    for (const p in placeholders) {
      text = text.replace(new RegExp(`\\{${p}\\}`, 'g'), placeholders[p]);
    }
  }
  return text;
}

/**
 * 切换语言并立即渲染
 */
function setLanguage(lang) {
  if (!translations[lang]) return;
  currentLang = lang;
  document.documentElement.lang = lang === 'zh' ? 'zh-CN' : lang;
  localStorage.setItem('appLang', lang);
  renderAll();
  setTimeout(renderAll, 100);
}

/**
 * 渲染页面上所有需要翻译的元素
 */
function renderAll() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    el.textContent = t(key);
  });
  document.querySelectorAll('[data-i18n-ph]').forEach(el => {
    const key = el.dataset.i18nPh;
    el.placeholder = t(key);
  });
  document.querySelectorAll('[data-i18n-dynamic]').forEach(el => {
    const key = el.dataset.i18nDynamic;
    const n = el.dataset.specN || 1;
    el.textContent = t(key, { n });
  });
  document.querySelectorAll('[data-i18n-button]').forEach(el => {
    const key = el.dataset.i18nButton;
    el.textContent = t(key);
  });
}

/**
 * 初始化语言（页面首次加载时调用）
 */
function initLanguage() {
  const saved = localStorage.getItem('appLang');
  setLanguage(saved && translations[saved] ? saved : 'en');
}

/* -------------------------------------------------
   全局暴露（main.js 里会直接调用）
   ------------------------------------------------- */
window.i18n = {
  t,
  setLanguage,
  renderAll,
  initLanguage,
  get currentLang() { return currentLang; }
};

/* -------------------------------------------------
   自动初始化
   ------------------------------------------------- */
document.addEventListener('DOMContentLoaded', () => {
  initLanguage();
});